# 传输层

![传输层](https://github.com/zzhangyuhang/computer-network/blob/master/photo/7.传输层.png)

上图是传输层的简单示例,网络层传递数据是在于主机和主机包之前进行传递,传输层则是进程和进程之间数据传递,而应用层则是应用和应用之间传递.


## 传输层的需求
* 传输层位置网络层之上,应用层之下,为应用层提供服务.
* 传输层应能同时支持多个网络应用
* 传输层应能检验传输是否出错
* 传输层协议能够提供应用层数据传输质量保证
	* 应用的多路复用/分用服务
	* 可靠的数据传输
	* 带宽以及延迟保证

![传输层传输数据示例](https://github.com/zzhangyuhang/computer-network/blob/master/photo/7.传输层传输数据示例.png)

上图是传输层数据的简单示例,应用层之间传输数据,应用层将数据下交给传输层,传输层建立端到端的逻辑连接,然后下交给网络层进行实际的数据传输.传输目的地同样要经历多层模型之后到达应用层.

## 传输层和网络层的关系
* 网络层提供的是不可靠传输
	* 网络层提供的服务不可靠(丢包和重复)
	* 路由器可能崩溃
	* 传输线路中断
* 当数据传输过程中网络连接中断,传输层可与远程传输实体建立一新的网络连接,在中断处继续数据的传输.
* 传输层可检测到包丢失和损坏乱序等差错情况,采取相应措施
* 传输层服务原语言独立于网络服务原语,因而应用程序可采用标准的传输原语.

![传输层和网络层的关系](https://github.com/zzhangyuhang/computer-network/blob/master/photo/7.传输层和网络层的关系.png)

上图是传输层和网络层关系的模拟图.如图所示,北京大学和南京大学相当于主机(端-端连接单位),每个同学相当于一个应用,每个同学将要发送给对面主机的数据交给小明和小芳,小明和小芳相当于传输层.但是小明和小芳也没有实际进行传输,而是再次交给邮递员完成实际的传输,这邮递员就是网络层(IP).邮递员根据实际地址完成真正的传输,就是邮政服务,相当于链路层.

![传输层和网络层的关系解释](https://github.com/zzhangyuhang/computer-network/blob/master/photo/7.传输层和网络层的关系解释.png)

* 网络层协议处理主机之间通信的事务
* 传输层协议处理应用进程之间通信的事务

![传输层和网络层的协议关系](https://github.com/zzhangyuhang/computer-network/blob/master/photo/7.传输层和网络层的协议关系.png)

上图是传输层和网络层协议之间的关系,传输层主要的协议有两种:TCP/UDP,同种类型之间的协议可以建立连接.建立连接后网络层协议根据传输层建立的连接建立自己的网络层的连接.

* 传输层提供的服务
	* 传输层协议要解决的问题取决于网络底层所能提供的服务质量
	* 需要解决网络层服务的问题
		* 丢包
		* 出错
		* 顺序混乱
* 传输层可以提供可靠(TCP)和不可靠(UDP)的网络服务
	* 基于可靠有序网络服务
		* 寻址(定位应用程序)
		* 多路复用(为多个应用服务)
		* 流量控制(发送接收匹配)
		* 连接建立/释放
	* 基于不可靠的网络服务
		* 寻址(定位应用程序)
		* 多路复用(为多个应用服务)
		* 流量控制(发送接收匹配)
		* 连接建立/释放
		* 有序传送(保证数据顺序)
		* 重传策略(报文丢失出错后)
		* 重复检测(必须丢失重复报文)
		* 系统崩溃修复

## 传输层的基本功能
* 建立连接
	* 面向连接:通信双方要先建立一条逻辑链路才能开展数据传输业务.大多数面向连接的服务提供了可靠的通信.
		* 流程
			* 建立连接
			* 传输报文
			* 拆除连接
	* 无连接:通信双方无需事先建立连接协商同喜事宜就能直接发送报文.大多数无连接通信是不可靠的.
		* 流程
			* 传输报文
		* 应用领域
			* 内部数据收集
			* 外部数据发布
			* 请求-响应
			* 实时流媒体应用
	* 连接性是传输层向上层用户提供的服务使用方式
	* 可靠数据传输
		* 报文不丢失/不重复/不损坏/不乱序
	* 不可靠数据传输怒
		* 报文可能丢失/可能重复/可能损坏/可能乱序
	* 可靠性是传输层向上层用户提供的服务的质量保障
* 分用:当传输层从网络层接收数据后,必须将数据正确递交给某个应用程序.
* 复用:当传输层从应用程序接收报文后要封装在传输层的段中再交给网络层发送.
* 差错检验和差错控制:传输层举报检验所传报文是否出错并实行控制的能力
	* 差错检验
		* 给报文标号
		* 设置超时计时器
		* 序号检测和计时器超时
	* 差错控制
		* 报文丢失(超时机制)
		* 报文重复(序号检测)
		* 报文损坏(计算校验和)
		* 报文乱序(顺序检测)
	* 差错控制是数据传输可靠性保障的基础
	* 差错控制是传输服务质量保证的前提
* 流量控制和拥塞控制
	* 流量控制:发送方和接收方的计算\缓存和收发能力不一致都将造成报文发送和接收在速度上的差异.对象是两端进程
	* 拥塞控制:网络总任何一个区域的报文转发不畅都有可能造成报文丢失/时延过长,任其发展后果严重.对象是整个网络.