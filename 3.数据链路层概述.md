# 数据链路层概述
* 数据链路层的基本服务是将数据报从一个节点沿着通信链路移动到另一个节点。
* 链路层服务的细节取决于该条链路所用的链路层协议。

![数据链路层](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.数据链路层.png)

上图为数据链路层的一个图示，数据链路层连接不同实体主机-网络层。

* 数据链路层的基本功能
	* 居家用户:通过点对点链路接入互联网
	* 公共区域:通过共享信道访问因特网

## 数据链路层模型
### 数据单位
* 数据链路层基本交换的数据单位:帧
	* 网络层通过接口把数据包交给链路层
	* 链路层把包装成本层协议规定的格式（帧）
* 为什么要分许多较小的帧且有上限？
	* 接受缓冲区大小受到限制，能确定上限
	* 传输数据越长出错可能性越大
	* 一个节点不能占用信道时间过长（数据量较大占用时间长）

![包转帧](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.包转帧.png)

上图为数据从网络层到数据链路层的转化过程，数据从报文切割成为大小相同的数据包，数据包在数据链路层运输前被封装成为大小相同的帧。

### 基本任务
* 基础:网卡物理层针对具体介质产生相应信号，完成单个比特的传输。
* 目标:根据向网络层提供的服务类型，完成一块数据的传输，并达到相应服务质量。
* 功能:把单个比特传输功能扩展成块数据的传输。

### 面临问题

![基本功能](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.基本功能.png)

上图为数据链路层必须要提供的功能，但是每个功能也有面临的问题

* 成帧问题
	* 如何识别一个帧的开始？
	* 需要一种方法表示一个帧的开始和结束。
* 差错控制
	* 帧的传输出现错误、丢失或重复怎么办？
	* 需要接收方在收到遗传二进制后的数据时判断正确性。
	* 检查发现初五时要进行相应处理。
* 流量控制
	* 如果发送方和接受方的收发处理能力不一致，出现一方快速发送另一方来不及接受怎么办？
	* 需要一种控制机制，使得能力不一致的手法双方协同发送和接受行为，保证数据帧的正确传输。
* 滑动窗口
	* 当同时有控制信息和数据信息需要发送时先发哪个？
	* 需要设计一些技术机制，尽可能提高线路的利用率，由于减低传输成本。
* 介质访问控制
	* 如果收发双方所在的网络为广播网络，即所有节点通过同一个共享介质发送和接收，谁来决定该介质使用权？
	* 必须有一套控制或仲裁机制，公平的把共享介质的贷款分配给所需要的节点，同时要兼顾广播链路的利用率。

### 问题解决
#### 流量控制
* 流量控制:用来确保发送实体发出的数据不会覆盖接受实体已接受的数据。
* 帧传输要求
	* 无丢失无差错
	* 按发出次序到达
	* 具有不等长的延时

![帧传输模型](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.帧传输模型.png)

上图为帧传输的模型，我们看到发送方编号为1的帧和2帧之间发送的时候并不是连续的，这就是帧的传播延迟。虽然帧在传输有延迟，但是具有严格的次序性。

#### 等-停流量控制
* 等-停流量控制:发送实体发送一个帧，接受实体收到后发回一个对该帧的确认，表示同意接受下一个帧;发送实体必须等待，收到确认后才能发送下一个帧。
* 链路为半双工链路连接，同时只能有一个方向的帧传输。

![等停流量控制](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.等停流量控制.png)

* 优点
	* 控制简单
	* 适当于当包被分成数量不多的帧发送，因为接收方发送每个帧都需要接受方的回复才会继续发送。
* 缺点
	* 效率不高，因为需要等待回复
	* 当一个包用多个帧发送且链路传播时延大于发送时间，每个帧的传输都需要一个双向的传播耗时。

#### 滑动窗口流量控制
* 滑动窗口控制:利用窗口控制连续发送的数据量。
* 接受方收到一个帧后fa一个确认，该确认帧包括了接收方想要的下一个帧号。
* 滑动串口控制基本条件
	* 两个节点通过全双工链路连接，即一条链路能同时有两个方向的帧进行传输。
	* 收发双方为n个帧分配缓冲区
	* 每个数据帧都有一个编号

![滑动窗口流量控制](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.滑动窗口流量控制.png)

上图为滑动窗口流量控制示意图，接受双方都有一个用于存储数据帧的缓冲区，每个帧都有自己的序号。但是问题出现，就是需要本身也占用空间，当数据帧量巨大的时候，序号占用空间巨大，怎么办？

* 序号空间：帧序号的取值范围。通常协议规定了帧格式中表示序号的二进制比特数。
* 序号空间循环特性
	* 被发送的帧按照顺序编号
	* 当用尽最大序号后下一个帧序号回滚到0

![循环序号空间](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.循环序号空间.png)

采用循环序号空间，大大减少了序号增长所占用的空间。

* 发送窗口和接受窗口
	* 发送窗口:给出允许发送方连续发送的帧序号
	* 接受窗口:给出允许接受方接受的帧序号
* 发送窗口和接收窗口可以不一样大
* 发送窗口和接收窗口沿顺时针方向滑动
* 窗口不是输出/输入缓冲区，只是发送待发送/接受帧的序号
* 窗口在收到响应的时候修改窗口帧号。
* 发送方只能发送帧号落在发送窗口内的帧，收到确认后将发送窗口向前退进。
* 接收方每收到一个帧，效验正确且序号落在接收窗口向前移动，并发出确认帧。

![发送窗口和接收窗口](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.发送窗口和接收窗口.png)

上图为发送窗口和接收窗口，我们看到发送窗口的大小为0-4，5个帧号；而接收窗口的大小为1，0开始，1个帧号。接收窗口收到发送的帧，修改接收窗口帧号，回复期待接收的下一个帧号n；在发送窗口收到接收窗口的回复以及所期待下个帧号的时候，修改发送窗口的帧号大小，下限变成接收窗口期待的帧号n，上限为（n+5）%5.

示例

![滑动窗口示例](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.滑动窗口示例.png)

上图为滑动窗口的示例，t0时刻发送窗口发送0-4的帧号数据，接收窗口准备接收编号为0的数据帧。接收到编号为0的数据帧，接收窗口修改窗口为1，并回复，期待数据编号为1给发送窗口，发送窗口收到后，修改发送窗口界限为 1-5，并发送数据。一直到t1时刻接收缓冲区准备接收编号为2的帧，发送窗口发送的数据编号为2-6.

* 捎带技术：基友数据又有确认时，将两者何在一个帧发送，即数据捎带上确认信息。

![捎带技术](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.捎带技术.png)

* 确认累计技术：为了节省宽带，接收方可对收到的k个帧（k < 发送窗口）发一个确认，告知发送方已确认接收前（k-1）帧并期待第k个帧。

![确认累计技术](https://github.com/zzhangyuhang/computer-network/blob/master/photo/3.确认累计技术.png)

注意，发送窗口移动的下限帧号为刚刚收到接收方期待接收的帧号。
