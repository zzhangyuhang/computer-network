# 网络-主机层
## 案例学习
### ADSL接入因特网
* ADSL是电话点对点的连接方式。
* 用原有的电话线进行互联网的数据传输，使用原本的点到点的连接方式。

![数字订户线路DSL](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.数字订户线路DSL.png)

上图是通过原有电话线路连接互联网，本地电脑通过猫将数据调制成信号，然后信号传递给xSDL线路进行数据传输，端局为你搭建好连接因特网的线路，联通整条线路完成数据传输。但是和电话共用一条线路不能影响用户通话。初期似乎很受影响，小时候要想上网必须将电话线拔掉插到电脑上，这样就不能接电话；不插入电话线不能上网。因为上网和电话公用一条线路且必须独占才能完成信号传输.十分影响用户正常使用。

后来发明了分离器，在分离器的帮助下可以分离电脑发出的数据信号和电话传输的语音信号，这样电话和上网就能公用一个线路来完成。

![分离器与非对称DSL](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.分离器与非对称DSL.png)

非对称DSL指的是点对点线路被分成若干个子线路，每条线路的传输速度不同，支持传输的方向也是不同的。最上边的叫下行通道，带宽高，仅支持单工传输，用于数据回传。中间的叫上行通道，带宽适中，支持全双工传输，用于数据交互。最下边的是语音信道，电话专用通道。

### 点到点协议（PPP）
#### 网络-主机层的结构

![网络-主机层的结构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.网络-主机层的结构.png)

上图为主机网络层的结构，一般每个分层都有自己的协议，每个协议处于两层的接口这间，用于处理两个接口间的数据传输。如图，IP/其他是网络层的常用协议，通过该协议的数据转换传输到网络层的接口，然后传递到网络-主机层的PPP协议，然后经过处理传递到网络-主机层的ADSL电路/其他电路链路接口。

* 点-点协议是一个可用于调制解调器，比特串行电路、SONET和其他物理层的多协议成帧机制。

![点-点协议](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.点-点协议.png)

上图是点到点协议的示意图，注意，PPP不包括的功能，它不能用于差错纠正，只能用于差错检验，检验出来的错误回馈给上一层，并不能解决错误。PPP也不能用于流量控制，同时传输的成帧数据也不具有一定的顺序性，只能用于点对点，并没有多点链路。

![PPP标准组成以及工作过程](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.PPP标准组成以及工作过程.png)

* PPP标准组成
	* 明确的成帧方法：一种将数据封装成PPP帧的方法。
	* 一个链路控制协议（LCP）：一个初始化、维护和拆除PPP链路的协议。
	* 一组网络控制协议（NCP）：一组协议，每个用于一个高层网络层协议。

* PPP成帧的方法
	* PPP用特殊的字符表示一个帧的开始和结束。
	* 为了防止数据被当做特殊字符，用flag模式加转义字符明确起始和结束字符。

![PPP成帧方法](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.PPP成帧方法.png)

* ppp帧的格式

![PPP帧格式](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.PPP帧格式.png)

* PPP协议的控制帧

![PPP协议的控制帧](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.PPP协议的控制帧.png)

* PPP控制协议协商过程

![PPP控制协议协商过程](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.PPP控制协议协商过程.png)

### 有线电视接入互联网

* 有线电视系统

![有线电视系统](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.有线电视系统.png)

* 通过有线电视线缆访问因特网

![通过有线电视线缆访问因特网](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.通过有线电视线缆访问因特网.png)

* 线缆通过频分多路复用实行双向数据通信，并且上下行通信速率不同。

![有线电视线缆结构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.有线电视线缆结构.png)

### 非对称数字线与有线电视电缆

![非对称数字线与有线电视电缆](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.非对称数字线与有线电视电缆.png)

## 竞争系统与介质访问控制
* 介质访问控制是指将传输介质带宽有效地分配给网上各节点用户的方法。

![共享传输介质](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.共享传输介质.png)

* 实现介质访问控制有两种方式
	* 同步控制
		* 为每个节点分配一个专用固定的容量
		* 类似频分多路复用或时分多路复用
	* 异步控制
		* 把信道容量动态分配给每个需要的节点
		* 响应用户的及时需要
* 异步控制有两种实现方式
	* 分布式：由各站共同完成介质访问控制，动态确定站的发送顺序。p to p，无控制节点。
	* 集中式：指定某个控制器具有控制网络访问的权利。有控制节点，主从模式。

![异步控制两种实现方式优缺点](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.异步控制两种实现方式优缺点.png)

### 共享介质访问控制
* 共享介质访问控制协议(MAC):将传输介质的容量有效地分配给网上各个节点用户的方法。
* 竞争系统:多个用户以某种可能导致冲突的方式共享公用信道的系统。
* 存在竞争的系统面临的三大问题
	* 访问时机:访问节点信道是否遵循某种约束
	* 冲突检测:发送数据时如何检测是否发生冲突
	* 重试策略:检测到冲突后如何处理

#### 共享介质访问协议
##### 纯ALOHA协议
* 基本思想
	* 按需访问信道
	* 不侦听信道，不知道信道是否被使用，不知道信道中是否有正在传输的信号。
	* 发生冲突随机重发。随机是指在随机的时间内。

![纯ALOHA协议](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.纯ALOHA协议.png)

上图为纯ALOHA协议的示意图，当一个帧被发送时，在该时间范围内其他节点的发送必将破坏该帧的传输，后发送的那个帧本身也被影响破坏点。基本上每个主机都是有数据的时候就会发送，发送后产生冲突后在随机的时间内再次发送。因为会频繁的出现帧冲突问题导致重发，信道的利用率不高。能够期待的信道利用率最多为18%。

##### 分槽ALOHA协议
* 假设
	* 时间槽长度 >= 发送一帧的时间
	* 各节点只能在下一时间槽的起始时刻开始发送信息。
* 基本思想
	* 访问信道只能在时间槽开始时进行
	* 不侦听信道
	* 发生冲突随机重发

![分槽ALOHA协议](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.分槽ALOHA协议.png)

上图为分槽ALOHA协议的示意图，每个节点发送数据帧的时候必须在时间槽开始的时候发送，但是发送的时候并不知道信道上是否正在被使用也就是是否有正在传输的帧。也会发送冲突，但是冲突只会发生在分槽开始时间点两个主机同时发送数据帧。减少了冲突产生的几率。必须要满足假设，时间槽单位大于数据帧，发送时间在时间槽起始时间。如果不满足假设则蜕化为纯ALOHA协议。大致流程就是时间槽发送，产生冲突后在随机时间时间槽再次发送。减少了冲突发生的次数，提高了信道的利用率。能够期待的信道利用率最多为36%。

##### 载波监听多路访问(CSMA)
* 载波监听协议：网络节点监听载波是否存在(即有无传输)并随之采取相应的行动。
* 基本思想
	* 想要传输的节点首先听以听介质上是否有其他站点在传播(载波侦听)
	* 如果有，必须等待。没有则可以传送数据帧。

### IEEE802.3协议
* IEEE802.3通常指以太网，是一种网络协议。描述物理层和数据链路层的MAC子层的实现方法，在多种物理媒体上以多种速率采用CSMA/CD访问方式

![IEEE802.3协议](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.IEEE802.3协议.png)

#### 冲突检验

* 带冲突检验的载波侦听协议:网络节点侦听载波是否存在(即有无传输)并随之采用相应的行动，并在传送过程中检测是否发生冲突。
* CSMA/CD基本思想
	* 若介质空闲，则传输。
	* 若介质忙，一直监听知道信道空闲，马上传输。
	* 若在传输期间检测到冲突，立即停止传输，等待一个随机事件再次侦听传输。
* CSMA/CD模型
	* 竞争:发送节点检测到发送帧冲突的最短时间。
	* 传输:发送节点传输帧，且不会发生冲突。
	* 空闲:所有节点都处于静止状态(无帧发送)
* 具体流程:发送检测 -> 冲突 -> 等随机时间后再发送

![带冲突检验的CSMA](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.带冲突检验的CSMA.png)

* 如何确定竞争是否胜出？

![带冲突检验的CSMA如何胜出](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.带冲突检验的CSMA如何胜出.png)

上图假设了一个简单流程，A给B发送数据帧，A到B传输的时间为t。如果A传输后的2t时间内没有收到冲突的信号(特殊的加强信号)反馈，即可以认为竞争成功，取得电缆的使用。如果产生了冲突，收到了反馈的信号，竞争失败，需要等待随机时间再次进行竞争传输。

* 冲突窗口:开始发送帧后侦听到是否发送冲突的那段时间。一般为两个最远传输节点之间的往返传输时间。
* 检验到冲突后的处理过程
	* 立即停止发送帧的其余内容，并发送阻塞信号JAM
	* 按后退算法计算重发时间延迟
	* 若重发16次扔不成功，则放弃
* 后退算法

![后退算法](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.后退算法.png)

* 重发等待窗口:每个发生冲突，都会将等待窗口大小加倍，然后从该等待窗口中随机选择一个等待时间。例如，等待窗口是[1-16],从中产生的随机数7，即等待7个时间。这个随机数无论大小只要落在窗口中即可。节点发送不成功后必须重新发送，重发的等待窗口(再次发送的等待时间)将随冲突次数的增加而急剧增大。

![重发等待窗口](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.重发等待窗口.png)

#### MAC帧

* 帧结构

![帧结构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.帧结构.png)

* 为了区分有效帧/垃圾帧，规定有效帧必须至少为64字节长度。

* 成帧方法

![成帧方法](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.成帧方法.png)

#### 地址

![帧地址](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.帧地址.png)

#### 通信方式
* 802.3协议支持一对一的单播，一对全部的广播和一对多的组播三种通信方式。
* 广播网络中的每个节点必须有标识自己的地址
* 发送的数据帧必须给出接收方和发送方的地址。

#### 数据传输服务
* 802.3提供了不可靠的无连接数据传输服务。

![MAC服务](https://github.com/zzhangyuhang/computer-network/blob/master/photo/4.MAC服务.png)


