# 应用层
## 网络应用结构

![网络应用结构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.网络应用结构.png)

上面是网络应用层的大致结构示意图,网络应用主要是传输层提供服务.主要服务的协议有TCP/UDP.TCP协议典型使用的应用是浏览器/即使通讯,这些应用的特点是传输的信息必须准确可靠.UDP协议典型的应用是域名系统DNS和流媒体应用,这些应用的特点是不在乎信息的传递是否可靠,追求传输速度和响应速度.

![网络应用架构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.网络应用架构.png)

上图是网络应用的架构,主要分为三种:1.C/S 2.B/S 3.P2P

### 客户机-服务器(C/S)

* 客户机-服务器模式特点(C/S)
	* 完成特定服务的一段程序作为常驻内存进程运行在一台机器上,等待客户机进程的请求
	* 用户端系统必须安装该网络服务的客户端程序,通过该客户进程请求服务器的服务
	* 客户机之间不直接通信

![客户机服务器架构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.客户机服务器架构.png)

注意,客户机之间是不直接通信的.

* 服务器响应客户机请求
	* 服务器在一个众所周知的端口等待客户机的请求
	* 客户机想该服务器端口发送连接请求

![客户机申请服务过程](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.客户机申请服务过程.png)

上面是客户机申请服务过程,第一阶段:客户机与服务器建立连接;第二阶段:服务器响应客户机的请求.

![客户机申请服务流程](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.客户机申请服务流程.png)

### 浏览器-服务器(B/S)

* 用户通过浏览器使用网络服务
* 客户端的客户机进程是浏览器
* 浏览器和服务器通信协议是HTTP
* 浏览器和服务器交换的报文是HTML

![浏览器结构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.浏览器结构.png)

上图是浏览器的结构,浏览器是一个对web的解释器,应用的协议有HTTP,FTP,SMTP,VoIP等.

* 内嵌应用
	* www
	* 流媒体应用:直播,点播
	* 网页版:电子邮件,微信,QQ

![BS架构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.BS架构.png)

上图是B/S架构,跟C/S的区别是客户机替换成了浏览器.实际是客户端运行的进程是浏览器而已.C/S的更精确化是B/S.

* 示例:万维网(www)
	* 万维网:基于因特网的分布式信息查询系统
	* HTML:编写web页面的超文本标记语言
	* web页面:使用超文本标记语言(HTML)编写的文档
	* HTTP:浏览器与服务器通信遵守的超文本传输协议
	* 超链接:指向一个页面的文字/图标或图像

![万维网结构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.万维网结构.png)

### 对等服务(P2P)

* 无固定的服务器
* 无固定的客户机
* 客户机直接通信
* 无集中控制中心
* 系统具有一定扩展性
* 系统管理复杂
* 典型应用
	* BitTorrent,maze
	* PPlive
	* QQ,MSN

![P2P结构](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.P2P结构.png)

### C/S和PSP实现文件共享

![CS实现文件共享](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.CS实现文件共享.png)

上图是C/S模式的文件共享,因为客户机之间不能直接共享文件,只能通过服务器来完成共享,需要共享的文件只需要在服务器加载即可.所需时间就是客户机从服务器接收数据的时间,随着客户机的数量线性增加.

![P2P实现文件共享](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.P2P实现文件共享.png)

上图是P2P模式的文件共享系统,因为客户机之间是同等的,所以需要将共享的文件传输到公众的地方进行分享.然后使用的时候再完成下载.下载的时间和C/S相等并且随着客户机的数量线性增加,但是同时客户机需要同时扩大系统容量.
	

## 网络性能
* 流:从一个源端发送到目标端的数据包流
	* 面向连接网络:流失一个连接上的全部数据包
	* 无连接网络:流是从一个进程发送到另一个进程的所有数据包
* 带宽:客户机-服务器两端通信获得的端-端数据率,单位是每秒比特数(bps)
* 时延:开始发送报文到接收报文所需要的时间,单位是秒(s)
* 抖动:接收端相邻两个报文的时延差,即前后两个时间的到达时间差,单位是秒(s)
* 丢失:接收端收到的报文和发送端发出的全部报文的比率,单位是百分比(%)

![抖动和丢失率公式](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.抖动和丢失率公式.png)

* 服务质量:一个流对网络性能的需求(带宽/时延/抖动和丢失)

![网络性能评判](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.网络性能评判.png)

注意抖动是两到达包之间的时间差,而时延则是所有的报文达到所需要的时间.

![网络应用服务质量要求](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.网络应用服务质量要求.png)

上图是网络应用服务质量要求一览,不同的应用对服务质量的需求也不一样.注意,这个高低是容忍度.视频点播可以忍受少量破防卡顿,但是不能够忍受画面跳跃.所以对带宽和抖动容忍度比较高,对延迟和丢失容忍度比较低.

## 网络流媒体应用
* 多媒体:包含两个或两个以上的媒体,通常意味着音频与视频.
	* 含图形声音文本的网页
	* 含图形图像的书籍
	* 音频/视频
* 流媒体:必须以定好的时间间隔播放的媒体
	* 音频:在线听歌/打电话
	* 视频:看录像/视频
	* 音视频:直播/可视电话
* 流媒体应用:内容涉及流媒体的应用
	* 应用模式
		* 客户机-服务器
		* 浏览器-服务器
		* 对等-对等
	* 流式:即边下载边播放.媒体播放器在播放音频/视频文件某个部分的同时下载该文件的后续部分.
		* 存储的流式音频/视频
			* 音频文件存储在服务器上供快速下载
			* 客户机可在下载完整文件前播放音视频
			* 抖动是非常重要的一个性能参数
			* 例如:视频点播(VoD)
		* 实况的流式音频/视频
			* 实时采集音频/视频信息,转换成数字形式
			* 在经过压缩后传输
			* 时延和抖动对实况转播都很重要
			* 例如:直播流媒体(体育赛事)
		* 实时交互的音频/视频
			* 具有面对面交互特性
			* 受网络时延影响较大
			* 时延和抖动对实况转播都很重要,但时延的大小至关重要
			* 例如:QQ视频电话
		* 区别
			* 存储的流式是将数据存储在服务器上,客户端根据需求进行暂停/反转/快进等操作数据流的传输,实况则不能直接快进媒体流.而实时交互则是进行网络视频/音频交流同样也不能快进.

### 音频压缩
* 数字音频:声波的数字表示,数字表示能重现音频.
* 未压缩的音频传输需要的带宽需求和传输时间目前很难满足
* 数字化和压缩式流媒体网络应用基本条件
* 编码:作用在源端,对数据进行压缩处理,以便传输
* 解码:作用在目标端,解压数据还原出原始信息
* 有损系统:解码输出引号不完全等同于原始输入信号
* 无损系统:输出信号和输入信号完全相同

### 流式媒体应用
#### 点播音频/视频(在线播放)
* 流式:媒体播放器在短暂停顿后开始播放用户请求的音视频,边播放边下载该音频文件的后续部分.
	* 服务器上的音视频文件已经被压缩好
	* 用户听/看的同事播放器下载后续内容
	* 一旦启动可连续播放

#### 通过web服务器访问音频/视频

![通过web服务器访问](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.通过web服务器访问.png)

上图是通过web服务器访问音视频,客户端通过浏览器与web服务器进行通信,服务器将文件传输给浏览器,浏览器缓存到本地磁盘,然后将本地的缓存文件调用播放器播放.播放器播放的是本地缓存的文件.这样本地需要缓存文件,浪费空间.

* 通过meta文件实现播放器与web服务器之间相连
	* Meta文件:提供了有关已流化的音频/视频文件信息(url或者编码方式)
	
![播放器直接与web服务器访问](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.播放器直接与web服务器访问.png)

上图是播放器直接与web服务器访问.在连接之前需要通过浏览器与web服务进行HTTP连接请求,然后web服务器回复meta文件给浏览器,浏览器将meta文件交给播放器.然后播放器与web服务器进行用HTTP方式直接联系.但是HTTP连接并不能支持暂停/回复/快进/跳过等操作.

* 通过引入流媒体服务器实现控制播放.
* 描述文件:包括多个连续的流莫提文件以及同步这些连续流媒体文件的指示.
	* 播放器直接向流媒体服务器请求文件
	* 播放器与媒体服务器通过专用协议通信

![播放器直接与流媒体服务器访问](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.播放器直接与流媒体服务器访问.png)

引入了流媒体服务器,使播放器直接与流媒体服务器进行连接,可以实现控制播放的功能,之间建立建立的时候需要跟之前一样需要浏览器通过HTTP协议向web服务器进行请求.web服务器回应请求一个presentation描述文件,之前是meta文件.然后浏览器将presentation描述文件下交给播放器直接与流媒体服务器进行连接.

![流媒体服务器控制播放](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.流媒体服务器控制播放.png)

上图是播放器通过RTSP协议控制流媒体的播放.

* RTSP协议:媒体播放器和流媒体服务器用来交换播放控制信息的协议.
* 带外:指存在一个独立于数据通道的额外通道.

![播放器使用RTSP协议](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.播放器使用RTSP协议.png)

播放器使用RTSP协议发送的命令是通过一个带外管道发送的,也就是单独的一条通道.RTSP协议的报文可以通过UDP/TCP发送.流媒体服务器接收到了来自客户端播放器的RTSP协议的请求来调整音视频数据.

* RTSP命令:为用户提供类似于本地播放的控制功能,包括暂停/恢复/快进/跳过等.

![RTSP协议命令](https://github.com/zzhangyuhang/computer-network/blob/master/photo/9.RTSP协议命令.png)

* RTSP协议特点
	* RTSP不负责音频/视频的压缩模式
	* RTSP不限制播放器如何缓冲音频/视频
	* RTSP不负责音频/视频的传输和封装
	* RTSP不限制流媒体的传输方式(UDP/TCP之上)